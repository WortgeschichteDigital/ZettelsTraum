<!doctype html>
<html lang="de">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="Content-Security-Policy" content="default-src 'self'">
		
		<title> </title>
		
		<link rel="stylesheet" href="../css/win/hilfe.css">
		
		<script src="../js/win/init-dokumentation.js"></script>
		<script src="../js/win/helferWin.js"></script>
		<script src="../js/win/hilfe.js"></script>
	</head>
	<body>
		<!-- KOPF -->
		<header>
			<h1>Technische Dokumentation</h1
				><img src="../img/icon.svg" width="48" height="48" alt="" id="icon">
		</header>
		
		<!-- GRID -->
		<main>
			<nav>
				<ul>
					<li><a href="#" class="link-sektion-technik kopf intern">Technik</a></li>
					<li><a href="#" class="link-sektion-ordner kopf intern">Ordner und Dateien</a></li>
					<li><a href="#" class="link-sektion-js kopf intern">JavaScript</a></li>
					<li><a href="#" class="link-sektion-wgd kopf intern">WGD-Dateiformat</a></li>
				</ul>
			</nav>
			<div>
				<!-- START -->
				<section id="sektion-start"
					><p class="obacht">Die technische Dokumentation ist nur für diejenigen gedacht, die das Programm bauen oder den Quellcode verändern wollen!</p
					><p>Allen anderen BenutzerInnen hilft das <a href="#" class="link-handbuch intern">Handbuch</a> vielleicht eher weiter.</p
				></section>
				
				<!-- TECHNIK -->
				<section id="sektion-technik"
					><h2 id="technik-electron-framework">Das <i>Electron</i>-Framework</h2
					><p><i class="app-name"></i> läuft auf dem <a href="#" title="https://electronjs.org/"><i>Electron</i></a>-Framework. <i>Electron</i> ist eine Kombination aus <a href="#" title="https://www.chromium.org/Home"><i>Chromium</i></a>, dem Open-Source-Browser, auf dem <i>Google Chrome</i> basiert, und <a href="#" title="https://nodejs.org/"><i>Node.js</i></a>, einer JavaScript-Laufzeitumgebung mit der Implementierung <i>V8</i>. Das Framework kann komplett via JavaScript gesteuert werden, weswegen zum Programmieren der App Kenntnisse in den Sprachen <abbr title="Hyptertext Markup Language" lang="en">HTML</abbr>, <abbr title="Cascading Style Sheets" lang="en">CSS</abbr> und JavaScript vollkommen ausreichen.</p
					><p><i>Electron</i> übernimmt die schwierigen Aufgaben, die sich beim Programmieren einer Desktop-App stellen. Es kümmert sich um die Integration in das Betriebssystem, ermöglicht also lesende und schreibende Dateizugriffe sowie das Öffnen externer Programme, erzeugt die Dateidialoge zum Öffnen und Speichern der Karteien und verwaltet über den betriebssystemeigenen Fenster-Manager die einzelnen Programm-Fenster, in denen eine leicht eingedampfte Variante des <i>Chromium</i>-Browsers für die Anzeige zuständig ist. Jedes Programm-Fenster läuft in einem eigenen Renderer-Prozess, weswegen die einzelnen Fenster nicht direkt miteiander kommunizieren können. Das Öffnen der Programm-Fenster und die Darstellung der Fenster-Menüs werden im Wesentlichten über den Main-Prozess gesteuert, über den die App initialisiert wird. Dieser wiederum kann mit allen Fenstern kommunizieren.</p
					><p>Der Main-Prozess wird über die Scripts in der Datei <span class="datei">./main.js</span> im Wurzelverzeichnis der App gesteuert (das Wurzelverzeichnis der App wird im Folgenden immer durch <span class="datei">./</span> bezeichnet). Vermittelt über diesen Prozess können die Fenster miteinander in Kommunikation treten. Über das Objekt <code class="quelltext">ipcMain</code> hört der Main-Prozess auf Meldungen der Renderer-Prozesse, die diese via <code class="quelltext">ipcRenderer</code> abgeschickt haben (<abbr title="vergleiche">vgl.</abbr> den Code in <span class="datei">./main.js</span> und <span class="datei">./js/app/init-app.js</span>).</p
					><p>Daneben erleichtert <i>Electron</i> das Paketieren der App für die Betriebssysteme <i>Linux</i>, <i>Windows</i> und <i>macOS</i> enorm. Aus der <a href="#technik-paketieren" class="intern sprung">paketierten App</a> lassen sich im Anschluss die verschiedensten <a href="#technik-installer" class="intern sprung">Installer</a> für die einzelnen Betriebssysteme bauen.</p
					
					><h2 id="technik-installation-electron">Installation von <i>Electron</i></h2
					><p>Im Folgenden wird die Einrichtung von <i>Electron</i> auf einer <i>Linux</i>-Distribution beschrieben, die auf <a href="#" title="https://www.ubuntu.com/"><i>Ubuntu</i></a> basiert. Die Anweisungen dürften aber für alle Betriebssystem ähnlich sein, denn auch unter Windows wird <i>Node.js</i> <abbr title="beispielsweise">bspw.</abbr> über die Eingabeaufforderung gesteuert.</p
					><p>Zunächst muss <i>Node.js</i> mit seinem Paketmanager <code>npm</code> installiert werden (für <i>Windows</i> gibt es <a href="#" title="https://nodejs.org/en/download/">eigene Installer</a>):</p
					
					><pre>sudo apt-get install nodejs</pre
					
					><p>Über die Eingaben <code>node -v</code> und <code>npm -v</code> bekommt man die Versionsnummern von <i>Node.js</i> <abbr title="beziehungsweise">bzw.</abbr> dessen Paketmanager angezeigt – ein einfacher Test, ob die Installation geklappt hat. Im Falle des Paketmanagers könnte ein Update ratsam sein:</p
					
					><pre>sudo npm install -g npm@latest</pre
					
					><p>Global lassen sich Programme aus dem <i>Node.js</i>-Respository (wie <abbr title="zum Beispiel">z. B.</abbr> das überaus hilfreiche <a href="#" title="https://jshint.com/">JSHint</a>) mithilfe des Schalters <code>-g</code> und Rootrechten (hier erlangt via <code>sudo</code>) installieren:</p
					
					><pre>sudo npm install -g [PROGRAMM]</pre
					
					><p><i>Electron</i> sollte allerdings nicht global, sondern lokal, <abbr title="das heißt">d. h.</abbr> im App-Ordern, installiert werden, sonst gibt es bei der späteren Paketierung mitunter Probleme – so zumindest meine Erfahrung. Das Zeichen für den aktuellen Pfad (<span class="datei">./</span>) steht hier und im Folgenden für das Wurzelverzeichnis der App, in dem <abbr title="unter anderem">u. a.</abbr> die Datei <span class="datei">./package.json</span> liegt. Die Installation ist simpel:</p
					
					><pre>cd ./
npm install --save-dev electron</pre
					
					><p>Während der Installation werden der Ordner <span class="datei">./node_modules/</span> und die Datei <span class="datei">./package-lock.json</span> erstellt. Der Ordner <span class="datei">./node_modules/</span> kann mehrere Hundert Megabyte groß sein!</p
					
					><p>Da im Herzen von <i>Electron</i> ein Browser schlägt und Browser fortwährend mit Sicherheitsupdates versorgt werden wollen, gibt es sehr häufig (alle ein bis zwei Wochen) <a href="#" title="https://electronjs.org/releases/stable"><i>Electron</i>-Updates</a>. Das Update funktioniert genauso wie die Erstinstallation:</p
					
					><pre>npm install --save-dev electron</pre
					
					><p>Welche <i>Electron</i>-Version im App-Ordner installiert ist, kann man dem Fenster <a href="#" class="ueber-electron intern"><i>Über Electron</i></a> (auch aufzurufen über das Menü <i>Hilfe</i> im Hauptfenster von <i class="app-name"></i>) oder der <span class="datei">./package.json</span> entnehmen:</p
					
					><pre class="quelltext">"devDependencies": {
	"electron": "^4.1.4",
	...
}</pre
					
					><p>Über die aktuelle Version im <i>Node.js</i>-Respository gibt der Paketmanager Auskunft:</p
					
					><pre>npm show electron version</pre
					
					><p>Die stabile Version von <i>Electron</i> liefert nie die jüngste Ausgabe von <i>Chromium</i>. Technisch ist der Browser somit zwar immer leicht veraltet, um die notwendigen Sicherheitsupdates kümmert sich das <i>Electron</i>-Team aber fortwährend.</p
					
					><h2 id="technik-starten">Starten der App</h2
					
					><p>Wie die App gestartet werden soll, wird in der Datei <span class="datei">./package.json</span> festgelegt. Die <span class="datei">./package.json</span> enthält neben Meta-Informationen zu Programm, Autor und Lizenz nämlich auch Scripts zum Starten und Paketieren von <i class="app-name"></i>. Die folgende Zeile legt fest, über welche Script-Datei der Main-Prozess initialisiert wird:</p
					
					><pre class="quelltext">"main": "main.js",</pre
					
					><p>Unter <code class="quelltext">"scripts"</code> steht <abbr title="unter anderem">u. a.</abbr> die Information, wie das Programm gestartet werden soll:</p
					
					><pre class="quelltext">"scripts": {
	"start": "electron .",
	...
}</pre
					
					><p>Für den Start der App ist bereits alles eingerichtet. Nach der Installation von <i>Electron</i> muss man im Programmordner nur noch den folgenden Befehl ausführen:</p
					
					><pre>npm start</pre
					
					><p>Nun sollte <i class="app-name"></i> im Entwickler-Modus gestartet werden. <abbr title="Das heißt">D. h.</abbr> konkret, dass sich über das Tastaturkürzel <kbd>Strg</kbd> + <kbd>⇧</kbd> + <kbd>I</kbd> die <i lang="en">Developer Tools</i> von <i>Chromium</i> öffnen lassen, die in der paketierten Version nicht mehr aufgerufen werden können. Außerdem erscheint im Hauptfenster das Menü <i>Dev</i>, das nach der Paketierung verschwunden ist.</p
					
					><h2 id="technik-paketieren">Paketieren der App</h2
					
					><p><mark>TODO</mark> Das Paketieren von <i class="app-name"></i> ist denkbar einfach.</p
					
					><h2 id="technik-installer">Installer bauen</h2
					
					><p><mark>TODO</mark> installer-win.js</p
					
					><h2 id="technik-ordner">Programm- und Konfigurationsordner</h2
					><p><mark>TODO</mark></p
				></section>
				
				<!-- ORDNER UND DATEIEN -->
				<section id="sektion-ordner"
					><p><mark>TODO</mark></p
				></section>
				
				<!-- JAVASCRIPT -->
				<section id="sektion-js"
					><h2 id="js-code">Der Code</h2
					><p>Der JavaScript-Code ist <i lang="en">vanilla</i>. Sprich: Es wurden keine externen Bibliotheken wie <i>jQuery</i> oder dergleichen verwendet. Programmiert wurde im <a href="#" title="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Strict_mode"><i lang="en">strict mode</i></a>, einer restringierten Variante von JavaScript, die <abbr title="zum Beispiel">z. B.</abbr> Zuweisungsoperationen zu nicht deklarierten Variablen unmöglicht macht und vieles mehr unterbindet, was potenziell gefährlich oder einfach schlechter Stil ist.</p
					
					><p>Der Code wurde extensiv kommentiert. Im Ergebnis sollte immer nachvollziehbar sein, welche Aufgabe das Script an der jeweiligen Stelle erfüllt. So wird <abbr title="zum Beispiel">z. B.</abbr> bei jeder Funktion angegeben, wozu sie dient und welchen Variablentyp die Argumente haben.</p
					
					><p>Alle Funktionen stecken in Objekten, um den Namensraum des Fensters nicht zu vermüllen. Dabei steht in jeder JavaScript-Datei ein Objekt, das exakt denselben Namen wie die Datei trägt. Sucht man also die Methode <code class="quelltext">popup.oeffnen()</code> oder die Eigenschaft <code class="quelltext">popup.belegID</code> muss man nur nach der Datei <span class="datei">popup.js</span> Ausschau halten. Eine Ausnahme bilden hier allein die Scripts im Wurzelverzeichnis und Dateien mit dem Namensmuster <span class="datei">init-*.js</span>. In letzteren werden Eventobjekte des Fensters initialisiert, zu dem die jeweilige Datei gehört. (Das betreffende Fenster lässt sich leicht am Dateinamen erkennen.) Einen Überblick über den Inhalt der Dateien gibt der Abschnitt <a href="#js-dateien" class="intern sprung"><i>Die Dateien</i></a>.</p
					
					><h2 id="js-integration">Integration von <i>Electron</i> und <i>Node.js</i></h2
					><p>Eine Besonderheit des JavaScript-Codes ist, dass auf Objekte, Methoden und Eigenschaften von <i>Electron</i> und <i>Node.js</i> auch in den Renderer-Prozessen zurückgegriffen wird. Hierzu wird die in JavaScript sonst nicht vorhandene Methode <code class="quelltext">require()</code> benutzt.</p
					><p>Über <code class="quelltext">const {app} = require("electron").remote</code> <abbr title="zum Beispiel">z. B.</abbr> wird der Zugriff auf das App-Objekt im Main-Prozess ermöglicht. Und via <code class="quelltext">const path = require("path")</code> kann man das Node-Modul <a href="#" title="https://nodejs.org/api/path.html"><i>Path</i></a> laden, um sich neben vielem anderen <abbr title="zum Beispiel">z. B.</abbr> Informationen über den <i lang="en">path segment separator</i> im aktuellen Betriebssystem geben zu lassen (nämlich via <code class="quelltext">path.sep</code>).</p
					
					><h2 id="js-dateien">Die Dateien</i></h2
					><p><mark>TODO</mark></p
				></section>
				
				<!-- WGD-DATEIFORMAT -->
				<section id="sektion-wgd"
					><p><mark>TODO</mark></p
				></section>
			</div>
		</main>
	</body>
</html>
