let G={dimensions:{width:720,height:500,lineMax:710,groupHeights:[51,55,59]},calculateTimespan(){var e,t=[...document.querySelectorAll("#wgd-belegauswahl > div")];let a=0;for(e of Object.values(l.data.lemmas)){for(var r of e.events){r=r.yearFrom;r&&(!a||r<a)&&(a=r)}for(var n of e.meanings)for(var i of n.quotations){i=this.getYear(i);i&&(!a||i<a)&&(a=i)}}a=a||this.getYear(t[0].id);let s=this.getYear(t.at(-1)?.id||t.at(-1));t=(new Date).getFullYear();return t-s<10&&(s=t<s+10?t:s+10),{first:a=s-a<10?s-10:a,last:s,pxYear:(this.dimensions.width-90)/(s-a)}},createElement(e,t={}){var a,r,n=document.createElementNS("http://www.w3.org/2000/svg",e);for([a,r]of Object.entries(t))n.setAttribute(a,r);return n},createGradient({svg:e,x1:t,x2:a,fadeIn:r,cl:n=""}){var i=e.querySelector("defs"),s="bedvisGradOut"+i.querySelectorAll("linearGradient").length,l={id:s,x1:t,x2:a,gradientUnits:"userSpaceOnUse"},o=(n&&(l.class=n),this.createElement("linearGradient",l));for(let m=1;m<=2;m++){var d=r?m-1:m%2;o.appendChild(this.createElement("stop",{offset:m-1,"stop-opacity":d}))}return i.appendChild(o),s},pointerEvent(e){e.setAttribute("pointer-events","auto");var t=this.createElement("title");e.appendChild(t)},getYear(e){var t;return"number"==typeof e?e:(t=document.querySelector(`#${e} time`))&&(t=t.getAttribute("datetime").match(/^[0-9]{4}/)?.[0])?parseInt(t,10):0},getLemma(e){if(/__.+?__/.test(e))return e.match(/__([^_]+)__/)[1];var t;for(t of[/›.+?‹/g,/‚.+?‘/g,/„.+?“/g,/\(.+?\)/g,/\[.+?\]/g,/\{.+?\}/g,/[,;._–]/g,/:(?= )/g,/(?<= )-(?= )/g])e=e.replace(t,"");return e.replace(/ {2,}/g," ").trim()}},l={data:{},validateData(){for(var e of Object.values(this.data.lemmas)){for(var t of e.events)t.yearFrom>t.yearTo?t.yearTo=t.yearFrom:!t.yearFrom&&t.yearTo?t.yearFrom=t.yearTo:t.yearFrom&&!t.yearTo&&(t.yearTo=t.yearFrom);for(var a of e.meanings)a.frequency<1?a.frequency=1:3<a.frequency&&(a.frequency=3)}},svg(e){let t;var a=(t=this.data.lemmaList?this.data.lemmas.lemmas.meanings.flatMap(e=>G.getLemma(e.definition)):Object.keys(this.data.lemmas)).join(" ").replace(/ /g,"_").toLowerCase(),r={"aria-labelledby":"bedvis-title-"+a,width:G.dimensions.width,height:G.dimensions.height,"pointer-events":"none",viewBox:`0 0 ${G.dimensions.width} `+G.dimensions.height,class:"bedvis"},r=(this.data.description&&(r["aria-describedby"]="bedvis-desc-"+a),this.data.lemmaList&&(r.class="bedvis lemma-list"),G.createElement("svg",r)),n=G.createElement("title",{id:"bedvis-title-"+a}),i=(r.appendChild(n),t.join("“, „").replace(/^(.+)(, )/,(...e)=>e[1]+" und ")),i=(this.data.lemmaList?n.textContent=`Chronologie der ${t.some(e=>/ /.test(e))?"Ausdrücke":"Wörter"} „${i}“`:n.textContent=`Chronologie der Bedeutungen von „${i}“`,this.data.description&&(n=G.createElement("desc",{id:"bedvis-desc-"+a}),r.appendChild(n),n.textContent=this.data.description),this.defs(r),G.calculateTimespan()),a=this.meanings(r,i,e),n=this.timeline(r,i,a),i=a+26+22*this.events({svg:r,timespan:i,top:a,timelineData:n});return r.setAttribute("height",i),r.setAttribute("viewBox",`0 0 ${G.dimensions.width} `+i),r},defs(e){var t,a=G.createElement("defs");e.appendChild(a),a.appendChild(G.createElement("path",{id:"bedvisArrow",d:"M 0 0 L 10 5 L 0 10 C 5 2, 5 8, 0 0"}));for(t of["Grey","Blue","BlueHover"]){var r=G.createElement("marker",{id:"bedvisArrow"+t,viewBox:"0 0 10 10",refX:"5",refY:"5",markerWidth:"16",markerHeight:"16",markerUnits:"userSpaceOnUse",class:"arrow-"+t.toLowerCase()});r.appendChild(G.createElement("use",{href:"#bedvisArrow"})),a.appendChild(r)}},meanings(n,i,s){var e,l=this.data.lemmaList;let o={};l&&((e=document.querySelector(".wgd-kopf-hl"))&&!e.parentNode.classList.contains("wgd-wortfeldartikel")&&e.textContent.split(/\s·\s/).forEach(e=>{o[e]=""}),document.querySelectorAll(".wgd-kopf-nl a").forEach(e=>{o[e.textContent]=e.getAttribute("href")}),document.querySelectorAll("#wgd-wortinformationen > div > p > a").forEach(e=>{var t=e.getAttribute("href");/^#/.test(t)&&(o[e.textContent]=t)}));var d,m,a,D=Object.keys(this.data.lemmas).length;let h=0;for([d,m]of Object.entries(this.data.lemmas)){1<D?(h+=16,(a=G.createElement("text",{x:G.dimensions.width/2,y:h,"dominant-baseline":"hanging","text-anchor":"middle",class:"lemma"})).textContent=d,n.appendChild(a),h+=40):h+=8;for(let e=0,t=m.meanings.length;e<t;e++){var c=m.meanings[e],p=document.getElementById(c.id);if(p||l){var r,u=[];for(r of c.quotations){var g=G.getYear(r);g&&u.push({id:r,year:g,yearText:"number"==typeof r?""+r:document.querySelector(`#${r} time`).textContent.replace(/[a-z]$/,"")})}if(u.length){e&&s.standalone&&(h+=15);var f=G.createElement("g"),v=(n.appendChild(f),G.pointerEvent(f),G.dimensions.groupHeights[c.frequency-1]),x=5+[0,2,4][c.frequency-1],y=50+Math.round((u[0].year-i.first)*i.pxYear);let r=G.dimensions.lineMax;c.usedUntil&&1<u.length&&(r=50+Math.round((u.at(-1).year-i.first)*i.pxYear));var b=[1,3,5][c.frequency-1],C=h+20+x,w=(f.appendChild(G.createElement("rect",{x:y,y:h,width:r-y,height:v,class:"blind"})),G.createElement("text",{x:y+x,y:h,"dominant-baseline":"hanging",class:"definition"})),E=c.definition||p?.querySelector("q")?.textContent||"[keine Angabe]";if(l)O(w,E,l);else{O(w,E,l);let e=p.querySelector(".wgd-zaehlz")?.textContent,t=p.parentNode.parentNode;for(;"LI"===t.nodeName;){var q=t.querySelector(".wgd-zaehlz")?.textContent;q&&(e=q+e),t=t.parentNode.parentNode}m.showNumbering&&e&&((k=G.createElement("tspan",{class:"bold","dominant-baseline":"hanging"})).textContent=e+" ".repeat(2),w.insertBefore(k,w.firstChild))}let a;if(l){let e=G.getLemma(c.definition);var k=["¹","²","³","⁴","⁵","⁶","⁷","⁸","⁹"].indexOf(e.substring(0,1));let t=0;if(0<=k&&(e=e.substring(1),t=k+1),void 0!==o[e])a=o[e];else if(s.artData?.values)e:for(var S of s.artData.values.le){var Y,U=parseInt(S.match(/ \((\d+)\)$/)?.[1]||0,10);for(Y of(S=S.replace(/ \(.+?\)$/,"")).split("/"))if(Y===e&&U===t){1<t&&(e+="-"+t),a=window.location.origin+"/wb/wortgeschichten/"+encodeURIComponent(e);break e}}}else a=p.querySelector("a")?.getAttribute("href");a&&/^(#|http)/.test(a)?((p=G.createElement("a",{href:a,tabindex:-1,class:"definition"})).appendChild(w),f.appendChild(p)):f.appendChild(w);var L,$,A,p={x1:y,y1:C,x2:r,y2:C,"stroke-width":b,class:"meaning"},w=(c.usedUntil||(p["marker-end"]="url(#bedvisArrowBlue)"),G.createElement("line",p)),p=(f.appendChild(w),[5,10,15][c.frequency-1]),F=p+","+p;if(c.usedFrom){let e=y-Math.round((u[0].year-c.usedFrom)*i.pxYear);var M=0<(e=y-e<30?y-30:e)?e:0;for(let t=1;t<=2;t++){var B=1===t?"extension-norm":"extension-hover",T=G.createGradient({svg:n,x1:M,x2:M+25,fadeIn:!0,cl:B}),T=G.createElement("line",{x1:M,y1:C,x2:y,y2:C,stroke:`url(#${T})`,"stroke-dasharray":F,"stroke-width":b,class:B});f.appendChild(T)}}if(c.usedUntil&&1<u.length){w.classList.add("meaning-obsolete");let e=r+Math.round((c.usedUntil-u.at(-1).year)*i.pxYear),t=(e=(e=e-r<30?r+30:e)>G.dimensions.lineMax?G.dimensions.lineMax:e)-25;t<r&&(t=r);for(let a=1;a<=2;a++){var _=1===a?"extension-norm":"extension-hover",I=G.createGradient({svg:n,x1:t,x2:e,fadeIn:!1,cl:_}),I=G.createElement("line",{x1:r,y1:C,x2:e,y2:C,stroke:`url(#${I})`,"stroke-dasharray":F,"stroke-width":b,class:_});f.appendChild(I)}}for(L of u)"number"!=typeof L.id&&($=50+Math.round((L.year-i.first)*i.pxYear),A=G.createElement("circle",{cx:$,cy:C,r:x,class:"quotation","data-id":L.id}),f.appendChild(A),A=G.createElement("text",{x:$,y:C+x+3,"dominant-baseline":"hanging",class:"year"}),f.appendChild(A),A.textContent=L.yearText);this.ariaDesc({ele:f,def:E,lemma:d,quotFirst:u[0].year,quotLast:1<u.length?u.at(-1).year:0,usedBefore:c.usedFrom,usedUntil:c.usedUntil}),h+=v+4}}}}function O(e,t,a){for(var r,n=!/›.+‹/.test(t)&&!a,i=[];t.length;){var s=t.match(/^[^_]+/)?.[0];if(s)i.push({text:s}),t=t.substring(s.length);else{let e;s=t.match(/^_+/)[0],s=(e=1===s.length?"italic":2===s.length?"bold":"italic bold",t.match(/^_+(.+?)_+/));i.push({text:s[1],cl:e}),t=t.substring(s[0].length)}}for(r of i){var l=G.createElement("tspan",{"dominant-baseline":"hanging"});r.cl&&l.setAttribute("class",r.cl),l.textContent=r.text,e.appendChild(l)}n&&((n=G.createElement("tspan",{"dominant-baseline":"hanging"})).textContent="›",e.insertBefore(n,e.firstChild),(n=G.createElement("tspan",{"dominant-baseline":"hanging"})).textContent="‹",e.appendChild(n))}return h+=20},ariaDesc({ele:e,def:t,lemma:a,quotFirst:r,quotLast:n,usedBefore:i,usedUntil:s}){let l=`Der früheste Beleg des Worts „${a}“ in der Bedeutung „${t}“ stammt aus dem Jahr ${r}.`;i&&i<r?(l+=" Diese Bedeutung war vermutlich schon vorher im Gebrauch",n?(l+=` und ist noch für das Jahr ${n} belegt.`,s?s===n?l+=" Später wurde sie vermutlich nicht mehr verwendet.":s!==n&&(l+=` Vermutlich wurde sie auch nach ${n} für einige Zeit verwendet, heute aber nicht mehr.`):l+=" Sie wird noch heute verwendet."):l+=s?".":" und wird noch heute verwendet."):s||(l+=" Diese Bedeutung wird noch heute verwendet."),e.setAttribute("aria-label",l)},timelineLabels:[],timeline(e,t,a){this.timelineLabels=[],e.appendChild(G.createElement("line",{x1:0,y1:a,x2:G.dimensions.lineMax,y2:a,"stroke-width":3,"marker-end":"url(#bedvisArrowGrey)",class:"timeline"}));var r=Math.floor(50/t.pxYear),n=t.first-r,i=50-r*t.pxYear;let s,l;l=t.last-t.first<30?(s=parseInt(n.toString().replace(/[0-9]$/,"0"),10)-5,5):t.last-t.first<100?(s=parseInt(n.toString().replace(/[0-9]$/,"0"),10)-10,10):t.last-t.first<300?(s=100*parseInt(n.toString().substring(0,2),10),parseInt(n.toString().substring(2),10)<=50?s+=50:s+=100,50):(s=100*parseInt(n.toString().substring(0,2),10)+100,100);do{var o,d=Math.round(i+(s-n)*t.pxYear);d<15?s+=l:((o=G.createElement("text",{x:d,y:a+6,"dominant-baseline":"hanging","text-anchor":"middle",class:"timeline-year"})).textContent=s,e.appendChild(o),s+=l,this.timelineLabels.push({ele:o,x:d-20}))}while(s<t.last);return{minYear:n,minYearX:i}},events({svg:n,timespan:i,top:s,timelineData:e}){var t,{minYear:l,minYearX:o}=e;let d=0;for(t of Object.values(this.data.lemmas))if(t.events.length)for(var m of t.events){var h=G.createElement("g",{class:"timeline-event"}),c=(n.appendChild(h),G.pointerEvent(h),Math.round(o+(m.yearFrom+Math.floor((m.yearTo-m.yearFrom)/2)-l)*i.pxYear));let a=c;if(m.yearTo===m.yearFrom)h.appendChild(G.createElement("rect",{x:c-5,y:s-5,width:10,height:10,transform:`rotate(45, ${c}, ${s})`}));else{let e=Math.round(o+(m.yearFrom-l)*i.pxYear),t=Math.round(o+(m.yearTo-l)*i.pxYear);for(;t-e<10;)e--,t++;(t-e)%2&&t++,a=e+Math.round((t-e)/2),h.appendChild(G.createElement("line",{x1:e,y1:s,x2:t,y2:s,class:"timeline-event-span"}))}h.appendChild(G.createElement("line",{x1:a,y1:s+28,x2:a,y2:s,class:"timeline-event-marker"}));let e=""+m.yearFrom,t=(m.yearTo!==m.yearFrom&&(e+="–"+m.yearTo),`<b>${e}</b>`);m.description&&(t+=" / "+m.description);var p,u,g=G.createElement("text",{x:c,y:s+10,class:"timeline-event-text","dominant-baseline":"hanging","text-anchor":"middle","data-description":t});let r=0;for(p of m.name.split("\n")){r++;var f=G.createElement("tspan",{x:c,dy:20,"dominant-baseline":"hanging"});f.textContent=p,g.appendChild(f)}h.appendChild(g),r>d&&(d=r);for(u of this.timelineLabels)if(c>u.x&&c<u.x+40){u.ele.parentNode.removeChild(u.ele);break}}return d}};export default{makeSVG(e,t={}){return l.data=e,l.validateData(),l.svg(t)||null},getLemma:e=>G.getLemma(e)};